<!DOCTYPE html>
<html lang="en">

  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="theme-color" content="#546E7A">

    

    <title>Mybatis：增删改查</title>

    
      
    

    <link rel="canonical" href="www.diaowenjie.cn/2020/04/27/java-Mybatis-second.html">

    
    <meta name="keywords" itemprop="keywords" content="blog,css,html,php">
    <link rel="shortcut icon" sizes="128x128" href="/avatar/favicon.png">

    <meta name="robots" content="noarchive">

   
    <style>
.site-header {
   background-color: #546E7A;
   }
.page-header {
   background: url("https://api.dujin.org/bing/1920.php") no-repeat center; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover; background-size:cover; max-width:100%; margin: auto;text-align: center;margin-bottom:20px;
}
</style>

    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/fade.css">
    <meta name="google-site-verification" content="tb5-LFfZ4ccQdqYC0-JKdEi3uWBF3IFo8PNsDcahigs" />
  </head>
  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    

    
      <a class="site-title" href="/">刁文杰的博客</a>
    

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#ffffff" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#ffffff" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#ffffff" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
              
              
            
          
            
            
              
                <a class="page-link" href="/Billboard.html">Billboard</a>
              
            
          
            
            
              
                <a class="page-link" href="/about.html">About</a>
              
            
          
            
            
              
                <a class="page-link" href="/archives.html">Archives</a>
              
            
          
            
            
          
            
            
          
            
            
              
                <a class="page-link" href="/links.html">Links</a>
              
            
          
            
            
          
            
            
              
                <a class="page-link" href="/pages/tags.html">Tags</a>
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    
    
    
    
    <script>
      var OriginTitile = document.title;
      var titleTime;
      document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
          document.title = '刁文杰的博客 ' + OriginTitile;
          clearTimeout(titleTime);
        }
        else {
          document.title = '刁文杰的博客 ' + OriginTitile;
          titleTime = setTimeout(function() {
            document.title = OriginTitile;
          }, 2000);
        }});

    </script>

    <section class="page-header">
      <h1 class="project-name">Mybatis：增删改查</h1>
      <h2 class="project-tagline"></h2>
      
        <h2 class="project-date">
        <time datetime="2020-04-27T00:00:00+08:00" itemprop="datePublished">
          
          Apr 27, 2020
        </time>
        
        
          • <span itemprop="author" itemscope itemtype=""><span itemprop="name">刁文杰的博客</span></span>
        
        </h2>
      
    </section>

    <section class="main-content fade">

      <article itemscope itemtype="">

  <header class="post-header">
      <link rel="dns-prefetch" href="//cdn.bootcss.com" />
    <h1 class="post-title" itemprop="name headline">Mybatis：增删改查</h1>
    <p class="post-meta">
      <time datetime="2020-04-27T00:00:00+08:00" itemprop="datePublished">
        
        Apr 27, 2020
      </time>
      </p>
  </header>
<script type="text/javascript" async
src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  document.getElementsByTagName("img").className="bbb";  
  </script>
  
  <div itemprop="articleBody">
    <blockquote>
  <p>记录Mybatis的增删改查和结果集深入和参数深入。</p>
</blockquote>

<h2 id="目录">目录</h2>
<ul id="markdown-toc">
  <li><a href="#目录" id="markdown-toc-目录">目录</a></li>
  <li><a href="#1mybatis的curd" id="markdown-toc-1mybatis的curd">1.Mybatis的curd</a>    <ul>
      <li><a href="#11基础操作" id="markdown-toc-11基础操作">1.1基础操作</a></li>
      <li><a href="#12-进阶操作" id="markdown-toc-12-进阶操作">1.2 进阶操作</a></li>
    </ul>
  </li>
  <li><a href="#2参数深入" id="markdown-toc-2参数深入">2.参数深入</a>    <ul>
      <li><a href="#21传递简单类型" id="markdown-toc-21传递简单类型">2.1传递简单类型</a></li>
      <li><a href="#22-传递pojo包装对象" id="markdown-toc-22-传递pojo包装对象">2.2 传递pojo包装对象</a></li>
    </ul>
  </li>
  <li><a href="#3结果集的深入" id="markdown-toc-3结果集的深入">3.结果集的深入</a>    <ul>
      <li><a href="#31-结果集起别名" id="markdown-toc-31-结果集起别名">3.1 结果集起别名</a></li>
      <li><a href="#32-配置映射关系" id="markdown-toc-32-配置映射关系">3.2 配置映射关系</a></li>
    </ul>
  </li>
  <li><a href="#4sqlmapconfigxml配置文件" id="markdown-toc-4sqlmapconfigxml配置文件">4.SqlMapConfig.xml配置文件</a>    <ul>
      <li><a href="#41使用properties进行配置jdbc" id="markdown-toc-41使用properties进行配置jdbc">4.1使用properties进行配置jdbc</a></li>
    </ul>
  </li>
</ul>
<h1 id="1mybatis的curd">1.Mybatis的curd</h1>

<p>在进行curd操作之前需要结合第一篇博客mybatis的入门进行构建项目，具体不表。</p>

<h2 id="11基础操作">1.1基础操作</h2>

<p>对于IUserDao.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IUserDao</span> <span class="o">{</span>

    <span class="cm">/**
     * 查询所有
     * @return
     */</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">();</span>

    <span class="cm">/**
     * 保存用户
     * @param user
     */</span>
    <span class="kt">void</span> <span class="nf">saveUser</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">);</span>

    <span class="cm">/**
     * 更新用户
     * @param user
     */</span>
    <span class="kt">void</span> <span class="nf">updateUser</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">);</span>

    <span class="cm">/**
     * 删除用户
     * @param userId
     */</span>
    <span class="kt">void</span> <span class="nf">deleteUser</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">userId</span><span class="o">);</span>

    <span class="cm">/**
     * 根据id查询用户
     * @param userId
     * @return
     */</span>
    <span class="nc">User</span> <span class="nf">findById</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">userId</span><span class="o">);</span>

    <span class="cm">/**
     * 根据名称模糊查询用户
     * @param username
     * @return
     */</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">findByName</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">);</span>

    <span class="cm">/**
     *  使用聚合函数查询所有
     * @return
     */</span>
    <span class="kt">int</span> <span class="nf">findTotal</span><span class="o">();</span>
<span class="o">}</span>

</code></pre></div></div>

<p>对应的IUserDao.xml文件，mybatis自动实现接口实现类，下面的xml与上面的接口是一一对应的。</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">"com.diaowenjie.dao.IUserDao"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!--查询所有--&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findAll"</span> <span class="na">resultType=</span><span class="s">"com.diaowenjie.domain.User"</span><span class="nt">&gt;</span>
        select * from user;
    <span class="nt">&lt;/select&gt;</span>

    <span class="c">&lt;!--保存用户--&gt;</span>
    <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">"saveUser"</span> <span class="na">parameterType=</span><span class="s">"com.diaowenjie.domain.User"</span><span class="nt">&gt;</span>
        insert  into user (username,address,sex,birthday) values (#{username},#{address},#{sex},#{birthday});
    <span class="nt">&lt;/insert&gt;</span>

    <span class="c">&lt;!--更新用户--&gt;</span>
    <span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">"updateUser"</span> <span class="na">parameterType=</span><span class="s">"com.diaowenjie.domain.User"</span><span class="nt">&gt;</span>
        update user set username=#{username},address=#{address},sex=#{sex},birthday=#{birthday} where id = #{id};
    <span class="nt">&lt;/update&gt;</span>

    <span class="c">&lt;!--删除用户 其中占位符id是可以随意写 因为只有一个--&gt;</span>
    <span class="nt">&lt;delete</span> <span class="na">id=</span><span class="s">"deleteUser"</span> <span class="na">parameterType=</span><span class="s">"Integer"</span><span class="nt">&gt;</span>
        delete from user where id = #{id};
    <span class="nt">&lt;/delete&gt;</span>

    <span class="c">&lt;!--根据id查询用户 --&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findById"</span> <span class="na">parameterType=</span><span class="s">"Integer"</span> <span class="na">resultType=</span><span class="s">"com.diaowenjie.domain.User"</span><span class="nt">&gt;</span>
        select * from user where id  = #{id};
    <span class="nt">&lt;/select&gt;</span>

    <span class="c">&lt;!--根据名称模糊查询用户 --&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findByName"</span> <span class="na">parameterType=</span><span class="s">"String"</span> <span class="na">resultType=</span><span class="s">"com.diaowenjie.domain.User"</span><span class="nt">&gt;</span>
--         select * from user where username like #{name};
        select * from user where username like '%${value}%'; <span class="c">&lt;!--这种了解，上面的用的更多。--&gt;</span>
    <span class="nt">&lt;/select&gt;</span>

    <span class="c">&lt;!--获取用户的总记录条数--&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findTotal"</span> <span class="na">resultType=</span><span class="s">"int"</span> <span class="nt">&gt;</span>
        select count(id) from user;
    <span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;/mapper&gt;</span>
</code></pre></div></div>

<p>对应的测试类：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Describe: mybatis 测试类。crud
 *
 * @author Seven on 2020/4/22
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MybatisTest</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">InputStream</span> <span class="n">in</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">SqlSession</span> <span class="n">sqlSession</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">IUserDao</span> <span class="n">userDao</span><span class="o">;</span>

    <span class="c1">//运行的初始化方法</span>
    <span class="nd">@Before</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">//1.读取配置文件</span>
        <span class="n">in</span> <span class="o">=</span> <span class="nc">Resources</span><span class="o">.</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">"sqlMapConfig.xml"</span><span class="o">);</span>
        <span class="c1">//2.创建sqlSessionFactory工厂</span>
        <span class="nc">SqlSessionFactoryBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SqlSessionFactoryBuilder</span><span class="o">();</span>
        <span class="nc">SqlSessionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">in</span><span class="o">);</span>
        <span class="c1">//3.使用工厂生产SQLSession对象</span>
        <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">openSession</span><span class="o">();</span>
        <span class="c1">//4.使用SQLSession创建Dao接口代理对象</span>
        <span class="n">userDao</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="nc">IUserDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">//运行的结束方法</span>
    <span class="nd">@After</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">//提交事务  不添加这一句数据写不进去 会回滚</span>
        <span class="n">sqlSession</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
        <span class="c1">//6.释放资源</span>
        <span class="n">sqlSession</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">in</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span>  <span class="nf">testFindAll</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>

        <span class="c1">//5.使用代理对象执行方法</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">userDao</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">User</span> <span class="nl">user:</span><span class="n">users</span><span class="o">){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSave</span><span class="o">(){</span>
        <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">();</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"测试"</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setAddress</span><span class="o">(</span><span class="s">"河南郑州"</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setSex</span><span class="o">(</span><span class="s">"男"</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setBirthday</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>
        <span class="c1">//5.执行保存用户</span>
        <span class="n">userDao</span><span class="o">.</span><span class="na">saveUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">//更新用户</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testUpdate</span><span class="o">(){</span>
        <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">();</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"测试"</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setAddress</span><span class="o">(</span><span class="s">"河南郑州"</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setSex</span><span class="o">(</span><span class="s">"女"</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">setBirthday</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>

        <span class="n">userDao</span><span class="o">.</span><span class="na">updateUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">//删除用户</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDelete</span><span class="o">(){</span>
        <span class="n">userDao</span><span class="o">.</span><span class="na">deleteUser</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">//根据id查询用户</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFindById</span><span class="o">(){</span>
        <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userDao</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="c1">//根据username查询</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFindByName</span><span class="o">(){</span>
        <span class="c1">//因为是模糊查询，所有需要提供%</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">userDao</span><span class="o">.</span><span class="na">findByName</span><span class="o">(</span><span class="s">"%王%"</span><span class="o">);</span>
        <span class="c1">//List&lt;User&gt; users = userDao.findByName("王"); 了解</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">User</span> <span class="nl">user:</span><span class="n">users</span><span class="o">){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">//测试查询总记录条数</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFindTotal</span><span class="o">(){</span>
        <span class="nc">Integer</span> <span class="n">total</span> <span class="o">=</span> <span class="n">userDao</span><span class="o">.</span><span class="na">findTotal</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">total</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h2 id="12-进阶操作">1.2 进阶操作</h2>

<p><strong>获取插入数据属性</strong></p>

<p>因为插入的数据的时候是不需要记性设置id的，所以需要在插入时候获取到插入数据的id，可以实现下次查找的时候直接直接按照id查找，这样只需要在xml中进行更改即可。对之前的saveUser进行更改。</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--保存用户--&gt;</span>
<span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">"saveUser"</span> <span class="na">parameterType=</span><span class="s">"com.diaowenjie.domain.User"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- 配置插入操作后，获取插入数据的id --&gt;</span>
    <span class="nt">&lt;selectKey</span> <span class="na">keyProperty=</span><span class="s">"id"</span> <span class="na">keyColumn=</span><span class="s">"id"</span> <span class="na">resultType=</span><span class="s">"int"</span> <span class="na">order=</span><span class="s">"AFTER"</span><span class="nt">&gt;</span>
        select  last_insert_id();
    <span class="nt">&lt;/selectKey&gt;</span>
    insert  into user (username,address,sex,birthday) values (#{username},#{address},#{sex},#{birthday});
<span class="nt">&lt;/insert&gt;</span>
</code></pre></div></div>

<p>其中order属性是在运行insert语句之前还是之后进行运行，现在设置的是之后，然后在进行插入语句测试以后</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSave</span><span class="o">(){</span>
    <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">();</span>
    <span class="n">user</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"测试00"</span><span class="o">);</span>
    <span class="n">user</span><span class="o">.</span><span class="na">setAddress</span><span class="o">(</span><span class="s">"河南郑州"</span><span class="o">);</span>
    <span class="n">user</span><span class="o">.</span><span class="na">setSex</span><span class="o">(</span><span class="s">"男"</span><span class="o">);</span>
    <span class="n">user</span><span class="o">.</span><span class="na">setBirthday</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"保存操作之前"</span> <span class="o">+</span> <span class="n">user</span><span class="o">);</span>
    <span class="c1">//5.执行保存用户</span>
    <span class="n">userDao</span><span class="o">.</span><span class="na">saveUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"保存操作之后"</span> <span class="o">+</span> <span class="n">user</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>保存操作之前User<span class="o">{</span><span class="nb">id</span><span class="o">=</span>null, <span class="nv">username</span><span class="o">=</span><span class="s1">'测试00'</span>, <span class="nv">birthday</span><span class="o">=</span>Tue Apr 28 15:23:16 CST 2020, <span class="nv">sex</span><span class="o">=</span><span class="s1">'男'</span>, <span class="nv">address</span><span class="o">=</span><span class="s1">'河南郑州'</span><span class="o">}</span>
保存操作之后User<span class="o">{</span><span class="nb">id</span><span class="o">=</span>6, <span class="nv">username</span><span class="o">=</span><span class="s1">'测试00'</span>, <span class="nv">birthday</span><span class="o">=</span>Tue Apr 28 15:23:16 CST 2020, <span class="nv">sex</span><span class="o">=</span><span class="s1">'男'</span>, <span class="nv">address</span><span class="o">=</span><span class="s1">'河南郑州'</span><span class="o">}</span>
</code></pre></div></div>

<p>可以看出来，保存以后，user中的id进行更新了，即获取到了对应的属性。</p>

<h1 id="2参数深入">2.参数深入</h1>

<h2 id="21传递简单类型">2.1传递简单类型</h2>

<p>Mybatis使用OGNL表达式解析对象字段的值，#{}或者${}括号中的值为pojo属性名称。</p>

<p>OGNL表达式：</p>

<p>Object Graphic Navigatio Language</p>

<p>对象	   图           导航  		 语言</p>

<p>他是通过对象的取值方法来获取数据，在在写法上把get给省略了。</p>

<p>比如：我们获取用户的名称：</p>

<ol>
  <li>类中的写法：user.getUsername();</li>
  <li>OGNL表达式写法 user.username;</li>
</ol>

<p>Mybatis中为什么能直接写username，而不是user.呢：因为在parameterType中已经提供了属性所属的类，所以此时不需要写对象名。</p>

<h2 id="22-传递pojo包装对象">2.2 传递pojo包装对象</h2>

<p>开发中通过pojo传递查询条件，查询条件是综合的查询条件，不仅包括用户查询条件还包括其他的查询条件，这时候可以使用包装对象传递输入参数。</p>

<p>对于查询条件来说，可以用一个对象进行封装，这样便能够更好的包装起来，实现如下：</p>

<p>设置一个新的类，queryVo.class 里面分装了查询条件。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">QueryVo</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">User</span> <span class="n">user</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">User</span> <span class="nf">getUser</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUser</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">user</span> <span class="o">=</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//通过queryVo对象进行查询数据</span>
<span class="cm">/**
  * 根据QueryVo中的条件查询用户
  * @param vo
  * @return
*/</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">findUserByVo</span><span class="o">(</span><span class="nc">QueryVo</span> <span class="n">vo</span><span class="o">);</span>
</code></pre></div></div>

<p>此时对应的xml配置文件</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--根据QueryVo的条件查询用户 传递过来的是一个对象，然后通过OGNL表达式获取到对应的属性--&gt;</span>
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findUserByVo"</span> <span class="na">parameterType=</span><span class="s">"com.diaowenjie.domain.QueryVo"</span> <span class="na">resultType=</span><span class="s">"com.diaowenjie.domain.User"</span><span class="nt">&gt;</span>
    select * from user where username like #{user.username};
<span class="nt">&lt;/select&gt;</span>
</code></pre></div></div>

<p>对应的测试类：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//测试使用QueryVo作为查询条件</span>
<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFindByVo</span><span class="o">(){</span>
    <span class="nc">QueryVo</span> <span class="n">queryVo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">QueryVo</span><span class="o">();</span>

    <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">();</span>
    <span class="n">user</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"%测%"</span><span class="o">);</span>
    <span class="n">queryVo</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
    <span class="c1">//因为是模糊查询，所有需要提供%</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">userDao</span><span class="o">.</span><span class="na">findUserByVo</span><span class="o">(</span><span class="n">queryVo</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">User</span> <span class="nl">u:</span><span class="n">users</span><span class="o">){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">u</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>User<span class="o">{</span><span class="nb">id</span><span class="o">=</span>1, <span class="nv">username</span><span class="o">=</span><span class="s1">'测试'</span>, <span class="nv">birthday</span><span class="o">=</span>Wed Apr 22 00:00:00 CST 2020, <span class="nv">sex</span><span class="o">=</span><span class="s1">'男'</span>, <span class="nv">address</span><span class="o">=</span><span class="s1">'北京'</span><span class="o">}</span>
User<span class="o">{</span><span class="nb">id</span><span class="o">=</span>6, <span class="nv">username</span><span class="o">=</span><span class="s1">'测试00'</span>, <span class="nv">birthday</span><span class="o">=</span>Tue Apr 28 00:00:00 CST 2020, <span class="nv">sex</span><span class="o">=</span><span class="s1">'男'</span>, <span class="nv">address</span><span class="o">=</span><span class="s1">'河南郑州'</span><span class="o">}</span>
</code></pre></div></div>

<p>以上这种实现方法，可以将查询条件进行封装，能够更好地优化程序。</p>

<h1 id="3结果集的深入">3.结果集的深入</h1>

<p>mysql数据库中，window下，userName与username是一样的，即不区分大小写。但是linux下是严格区分的。 当java实体类与数据库中的名称不一致时，此时从数据库中查询的结果边不能够正确的赋值到java实体类中。</p>

<h2 id="31-结果集起别名">3.1 结果集起别名</h2>

<p>一个好的解决方案就是将查询结果中的属性起别名，使别名与实体类名称保持一致。如下所示：</p>

<p>java实体类：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">userId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">userName</span><span class="o">;</span>   
    <span class="c1">//getter and setter</span>
<span class="o">}</span>
</code></pre></div></div>

<p>此时对应的数据库为：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`user`</span> <span class="p">(</span>
	<span class="nv">`id`</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
	<span class="nv">`username`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COLLATE</span> <span class="s1">'utf8_unicode_ci'</span><span class="p">,</span>
	<span class="k">INDEX</span> <span class="nv">`id`</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>可以看出此时二者名称是不一致的，这样会导致查询的结果不能够很好的封装到实体类中，解决方案在查询是为结果集取别名，其中别名与java实体类名称保持一致。</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--查询所有--&gt;</span>
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findAll"</span> <span class="na">resultType=</span><span class="s">"com.diaowenjie.domain.User"</span><span class="nt">&gt;</span>
    select id as userId, username as userName from user;
<span class="nt">&lt;/select&gt;</span>
</code></pre></div></div>

<p>此时便能够将数据封装进去，这种效果是最好的。</p>

<h2 id="32-配置映射关系">3.2 配置映射关系</h2>

<p>在IUserDao.xml中配置映射关系</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--配置 查询结果的列名和实体类的属性名的对应关系--&gt;</span>
<span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">"userMap"</span> <span class="na">type=</span><span class="s">"com.diaowenjie.domain.User"</span> <span class="nt">&gt;</span>
    <span class="c">&lt;!--主键字段的对应 --&gt;</span>
    <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">"userId"</span> <span class="na">column=</span><span class="s">"id"</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!--非主键字段的对应--&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">"userName"</span> <span class="na">column=</span><span class="s">"username"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</code></pre></div></div>

<p>然后将查询结果的xml使用：</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--查询所有--&gt;</span>
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findAll"</span> <span class="na">resultMap=</span><span class="s">"userMap"</span><span class="nt">&gt;</span>
    select * from user;
<span class="nt">&lt;/select&gt;</span>
</code></pre></div></div>

<p>需要将resultType更改为resultMap。</p>

<p>此种方法开发效率更高，但是执行效率更低一点。</p>

<h1 id="4sqlmapconfigxml配置文件">4.SqlMapConfig.xml配置文件</h1>

<p>SqlMapConfig.xml中配置的内容和顺序如下：</p>

<ol>
  <li>properties(属性)</li>
  <li>setting(全局配置参数)</li>
  <li>typeAliases(类型别名)</li>
  <li>typeHandlers(类型处理器)</li>
  <li>objectFactory(对象工厂)</li>
  <li>plugins(插件)</li>
  <li>evironments(环境集合属性对象)
    <ol>
      <li>environment(环境子属性对象)
        <ol>
          <li>transctionManager(事务管理器)</li>
          <li>dataSource(数据源)</li>
        </ol>
      </li>
    </ol>
  </li>
  <li>mappers(映射器)</li>
</ol>

<h2 id="41使用properties进行配置jdbc">4.1使用properties进行配置jdbc</h2>

<p><strong>Properties属性</strong></p>

<p>配置Properties可以在标签内部配置连接信息，也可以通过属性引用外部配置文件信息。其中可以使用ulr和resource两种写法。</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;properties</span> <span class="na">resource=</span><span class="s">"jdbcConfig.properties"</span><span class="nt">&gt;&lt;/properties&gt;</span>
<span class="nt">&lt;properties</span> <span class="na">url=</span><span class="s">" http://localhost:8080/mybatiserver/demo.properties"</span><span class="nt">&gt;&lt;/properties&gt;</span>
</code></pre></div></div>

<p><strong>resource属性：</strong>常用的。用于指定配置文件的位置，是按照类路径的写法来写，必须存在于类路径下。</p>

<p><strong>url属性：</strong>不常用。是要求按照url的写法来写地址。e.g. http://localhost:8080/mybatiserver/demo.properties读取网络资源。</p>

<p>1.首先是配置properties文件。在里面写好jdbc配置</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">jdbc.driver</span> <span class="p">=</span> <span class="s">com.mysql.jdbc.Driver</span>
<span class="py">jdbc.url</span> <span class="p">=</span> <span class="s">jdbc:mysql://localhost:3306/study_test</span>
<span class="py">jdbc.username</span> <span class="p">=</span> <span class="s">root</span>
<span class="py">jdbc.password</span> <span class="p">=</span> <span class="s">A123456</span>
</code></pre></div></div>

<p>2.更改sqlMapConfig.xml配置文件</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--引入上面的properties文件--&gt;</span>
<span class="nt">&lt;properties</span> <span class="na">resource=</span><span class="s">"jdbcConfig.properties"</span><span class="nt">&gt;&lt;/properties&gt;</span>

<span class="nt">&lt;dataSource</span> <span class="na">type=</span><span class="s">"POOLED"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- 配置连接数据的四个基本信息 进行读取配置文件中的属性，属性名要一一对应 --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driver"</span> <span class="na">value=</span><span class="s">"${jdbc.driver}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"url"</span> <span class="na">value=</span><span class="s">"${jdbc.url}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"${jdbc.username}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"${jdbc.password}"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/dataSource&gt;</span>
</code></pre></div></div>

<p>然后便能正常的运行，这样就将重要的配置抽取出来。</p>

<p><strong>typeAliases属性</strong></p>

<p>使用typeAliases配置别名，<strong>它只能配置domain中类的别名</strong>。</p>

<p>sqlMapConfig.xml配置文件中进行配置。</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--只能配置domain中的别名--&gt;</span>
<span class="nt">&lt;typeAliases&gt;</span>
    <span class="c">&lt;!--用于配置别名，type属性指定的是实体类全限定名，alias属性指定别名 当制定了别名就不区分大小写--&gt;</span>
    <span class="nt">&lt;typeAlias</span> <span class="na">type=</span><span class="s">"com.diaowenjie.domain.User"</span> <span class="na">alias=</span><span class="s">"user"</span><span class="nt">&gt;&lt;/typeAlias&gt;</span>
<span class="nt">&lt;/typeAliases&gt;</span>
</code></pre></div></div>

<p>然后在IUserDao.xml中就可以使用别名:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--查询所有 直接使用别名。--&gt;</span>
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"findAll"</span> <span class="na">resultType=</span><span class="s">"user"</span><span class="nt">&gt;</span>
    select * from user;
<span class="nt">&lt;/select&gt;</span>
</code></pre></div></div>

<p>但是以上的配置会出现起很多别名的情况，还有一种方式就是直接将包配置到别名上：</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;typeAliases&gt;</span>
    <span class="c">&lt;!--用户指定要配置别名的包，当指定以后，该包下的实体类都会注册别名，并且类名就是别名，不在区分大小写--&gt;</span>
    <span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">"com.diaowenjie.domain"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/typeAliases&gt;</span>
</code></pre></div></div>

<p>这样在IUserDao.xml使用实体类的时候，直接使用类名就行，上面的查询所有也可以直接的使用，这种方法更加的简单。</p>

<p><strong>Mappers中的package属性:</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--指定映射配置文件的位置，映射配置文件指的是每个dao独立的配置文件--&gt;</span>
<span class="nt">&lt;mappers&gt;</span>
    <span class="c">&lt;!--&lt;mapper resource="com/diaowenjie/dao/IUserDao.xml"/&gt;--&gt;</span>
    <span class="c">&lt;!-- package标签是用于指定dao接口所在的包，当指定了之后就需要在写mapper以及resource或者class了--&gt;</span>
    <span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">"com.diaowenjie.dao"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/mappers&gt;</span>
</code></pre></div></div>


  </div>

    
<footer>
    <div style="color: #B0BEC5">标签：
    
    <a class="tag" style="color: #E91E63;font-weight:bold" href="/pages/tags#java">#java</a>
    
  </div>
</footer>






  
  
  

  
  
</article>


      <footer class="site-footer">
        <!-- <span class="site-footer-owner"> 刁文杰的博客©2018-2019.</span> -->
        
      <center>
          <span class="site-footer-credits">刁文杰的博客©2018-2020.</span><br>
          <!-- <span class="site-footer-credits" style="font-size:12px">Already <span id="sitetime"></span> days.</span><br> -->
          <!-- <span class="site-footer-credits" href>浙ICP备2020039014号</span><br> -->
          <a href="http://beian.miit.gov.cn/" class="site-footer-credits"> 浙ICP备2020039014号</a> <br>
      </center>

     
        

      </footer>
    </section>

    

    
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      inlineMath: [['$','$']]
    }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>


      <script>
          ajax()
  function ajax(option){
    var xhr = null;
    if(window.XMLHttpRequest){
      xhr = new window.XMLHttpRequest();
    }else{ // ie
      xhr = new ActiveObject("Microsoft")
    }
    xhr.open("get","");
    xhr.send(null);
    xhr.onreadystatechange = function(){
      var time = null,
          curDate = null;
      if(xhr.readyState===2){
        // Get time
        time = xhr.getResponseHeader("Date");
        console.log(xhr.getAllResponseHeaders())
        curDate = new Date(time);
        document.getElementById("sitetime").innerHTML = (parseInt((((curDate.getTime() / 1000) - 1571133419 ) / 86400 )));
        
      }
    }
  }
      </script>
      
      <script src = '/assets/js/instantclick.min.js' data-no-instant></script>
      <script data-no-instant>InstantClick.init();</script>
      
  </body>
</html>
